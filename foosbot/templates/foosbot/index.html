
{% extends "base.html" %}

{% block body %}

  <div class="container">
  <div class="page-header">
  <h1 class='text-center'>Welcome<br> <small> This is Mike's Test Site </small></h1>
  </div>
  </div>

    <div class="row spacer">
    <div class="well col-md-6 col-md-offset-3">
    
    <div class="col-md-4">
      <div class="dropdown inline">    
        <button  id = "makes_dropdown" class="btn btn-primary dropdown-toggle button-wrap" type="button" data-toggle="dropdown">Select Make
        <span class="caret"></span></button>
        <ul id = "makes_list" class="dropdown-menu scrollable-menu" role="menu">
          <li><a href="javascript:Reset_Form();">Select Make</a></li>
        </ul>
      </div> <!-- End Makes Dropdown-->
    </div>

    <div class = "col-md-4">
      <div class="dropdown inline">    
        <button  id = "models_dropdown" class="btn btn-primary dropdown-toggle button-wrap" type="button" data-toggle="dropdown">Select Model
        <span class="caret"></span></button>
        <ul id = "models_list" class="dropdown-menu scrollable-menu" role="menu">
          <li><a href="javascript:Reset_Form();">-</a></li>
        </ul>
      </div> <!--End Models Dropdown -->
    </div>
      <div class="col-md-4">
          <input id ="submit" type="button" class="btn btn-success btn-send button-wrap" value="View Data">
  <div class="checkbox"> 
  <label>
  <input id = "anomaly_checkbox" type="checkbox" checked=""> Filter Anomalies
  </label>
  </div>
      </div> <!-- End Button div-->
    </div>
    </div> <!-- End Options Well -->

  <div class="row">
    <div class='col-md-6 col-md-offset-3'>
    <div id='result_content'> </div>

    </div>
  </div> <!-- End Model info row -->
<br>
          <div class="row">

            
            <div class="col-md-6">
              <div class="well">  
                <div id="plotContent1"></div>
              </div>
              </div>

            <div class="col-md-6">
                <div class="well">
                <div id="plotContent2"></div>
              </div>
              
            </div>
          </div>

    <div class="container">
    <h1>Test Table</h1>
    <table class="table table-hover">
      <thead>
        <tr>
          <th> One </th>
          <th> Two</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td> 1 </td>
          <td> 2 </td>
        </tr>
        <tr>
          <td> Eins</td>
          <td> Zwei</td>
        </tr>
      </tbody>
    </table>



    </div>

    <script src="../static/js/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="../static/js/jquery/jquery.form.js" type="text/javascript"></script> 

<script>
function load_plot(){
  var timestamp=+new Date;
  $("#plotContent1").load("../static/plot-year.html?t="+timestamp); 
  $("#plotContent2").load("../static/plot-kilos.html?t="+timestamp); 
}

function load_results(){
document.getElementById('result_content').innerHTML = "Model: " + current_model +
        "<br> Estimated price when new: $" + parseFloat(model_info.bias).toFixed(2) +
        "<br> Depretiation by Age(per year): $"+ parseFloat(-model_info.age).toFixed(2) +
        "<br> Depretiation by Kilometer(per 1000): $" + parseFloat(-model_info.kilometers).toFixed(2);
}

{% if results %}

var current_model = "{{ model }}";
var model_info= {{results | safe}};
$(function(){ load_results()});
$(function(){ load_plot()});

{% else %}

var current_model = "";
var model_info={};

{% endif %}

var makes_data = {};
var models_data = {};


$(function(){ 
  get_makes();
  var elm = document.getElementById("anomaly_checkbox");
  if (elm.checked != false) {
    elm.click();
  }
});


$(function(){
    //Submission function
    document.getElementById("submit").onclick = function() {

        var show_anomaly = true;
        if (anomaly_checkbox.checked) {show_anomaly=false;}

        var data = {'model':current_model, 'show_anomaly': show_anomaly};
        var options = {
            url: '/load_stats',
            type: 'POST',
            data: data,
            success: function(response) {
              model_info = response;                
              load_results();
            },
            error: function(error) {
                console.log(error);
                alert('error');
            }
        }
        $.ajax(options);
        
        load_plot();
        load_results();
    }
});


function get_makes(){
    //Populate dropdown menu with the IDs of all samples from the database
    var options={
        url: '/get_makes',
        type: 'POST',
        data: {'request_type': 'get_makes'},
        success: function(response) {
            //Update dropdown menu          

            $.each(response, function(index) {
            var sample_id = response[index].id
            makes_data[index] = sample_id;
            newItem = $("<li> <a href='javascript:get_models(" + index + ");'> " + sample_id + "</a></li>");
            $("#makes_list").append(newItem);
        }); 
        },
        error: function(error) {
            console.log(error);
        }
    }
    $.ajax(options)
}

function get_models(make_id){
    //Populate dropdown menu with the IDs of all samples from the database
    var options={
        url: '/get_models',
        type: 'POST',
        data: {'make': makes_data[make_id]},
        success: function(response) {
            //Update dropdown menu          
            $('#models_list').empty(); 
            $.each(response, function(index) {
            var sample_id = response[index].id
            models_data[index] = sample_id;
            newItem = $("<li> <a href='javascript:Load_Sample(" + index + ");'> " + sample_id + "</a></li>");
            $("#models_list").append(newItem);
        }); 
        },
        error: function(error) {
            console.log(error);
        }
    }
    $.ajax(options)
    document.getElementById('makes_dropdown').innerHTML = ""+ makes_data[make_id] + " <span class='caret'></span>";

}

function Load_Sample(model_id){
        current_model=models_data[model_id];
        var options={
          url: '/load_stats',
          type: 'POST',
          //dataType: 'json',
          //contentType: 'application/json',
          data: {'model':models_data[model_id]},
          success: function(response) {
            model_info = response;
            //document.getElementById('result_content').innerHTML = response;
            // for (i = 0; i < response.length; i++){
            //     var response_data=response[i];
            //     var response_name="";
            //     var response_value="";
            //     for (var key in response_data) {
            //         if (response_data.hasOwnProperty(key)) {
            //             if (key=='name'){
            //                 response_name = response_data[key];
            //             }
            //             else if(key=='value'){
            //                 response_value = response_data[key];
            //             }
            //         }
            //     } 
            //     document.getElementById(response_name).value = response_value;            
            //}
        },
        error: function(error) {
            console.log(error);
        }
    }
    //$.ajax(options);
    document.getElementById('models_dropdown').innerHTML = ""+ models_data[model_id] + " <span class='caret'></span>";
    current_model=models_data[model_id];

}

</script>

{% endblock %}